# Prometheus configuration для работы с Thanos

global:
  scrape_interval: 15s
  evaluation_interval: 15s

  # External labels для Thanos - идентификация источника метрик
  external_labels:
    cluster: "ur_prometheus_instance_name"
#    replica: "A"


scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus_exporter'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: 'ur_prometheus_instance_name'

  - job_name: 'node_exporter'
    static_configs:
      - targets: ['localhost:9100']
        labels:
          instance: 'server-01'

  - job_name: 'process_exporter'
    static_configs:
      - targets: ['localhost:9256']
        labels:
          instance: 'server-01'

  - job_name: 'mysql_exporter'
    static_configs:
      - targets: ['localhost:9104']
        labels:
          instance: 'mysql-server-01'

  - job_name: 'windows_exporter'
    static_configs:
      - targets: ['192.168.1.20:9182']
        labels:
          instance: 'windows-server-01'

  - job_name: 'cuba_jvm'
    static_configs:
      - targets: ['localhost:8080']
        labels:
          instance: 'cuba-app-01'

  # Thanos components
  # - job_name: 'thanos-sidecar'
  #   static_configs:
  #     - targets: ['localhost:10902']
  #       labels:
  #         instance: 'thanos-sidecar'

  # - job_name: 'thanos-query'
  #   static_configs:
  #     - targets: ['localhost:19090']
  #       labels:
  #         instance: 'thanos-query'

  # ========================================
  # FEDERATION - Федерация с удалённых Prometheus
  # ========================================
  # Раскомментировать при необходимости подключения к удалённым Prometheus

  # - job_name: 'federate-remote'
  #   scrape_interval: 30s
  #   honor_labels: true
  #   metrics_path: /federate
  #   scheme: https
  #
  #   params:
  #     'match[]':
  #       # Примеры фильтров метрик для федерации:
  #
  #       # 1. Все метрики конкретного job
  #       - '{job="node"}'
  #
  #       # 2. Конкретная метрика по job
  #       - '{__name__="up",job="node"}'
  #
  #       # 3. Все метрики node_exporter
  #       - '{__name__=~"node_.*"}'
  #
  #       # 4. Метрики по regex паттерну
  #       - '{__name__=~"process_.*|node_.*"}'
  #
  #   static_configs:
  #     - targets:
  #         - 'remote-prometheus.example.com:9090'
  #       labels:
  #         instance: 'remote-cluster-01'
  #
  #   # Basic Auth (если требуется)
  #   basic_auth:
  #     username: 'admin'
  #     password: 'password'
  #
  #   # TLS config (для HTTPS)
  #   tls_config:
  #     insecure_skip_verify: true  # только для самоподписанных сертификатов
  #     # ca_file: /etc/prometheus/ca.crt
  #     # cert_file: /etc/prometheus/client.crt
  #     # key_file: /etc/prometheus/client.key
  #
  # Проверка федерации через curl:
  # curl -k -u admin:password 'https://remote-prometheus.example.com:9090/federate?match[]={job="node"}'
